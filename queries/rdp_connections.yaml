name: "Remote Desktop Protocol Connections"
author: "Leon Schulze"
description: "Identifies RDP connection events that could indicate lateral movement within the network. Monitors both successful and failed RDP authentication attempts."
severity: "Medium"
content_type: hunting
category: "Lateral Movement"
tags:
  - "RDP"
  - "Remote Access"
  - "Network"
mitre_ids:
  - "T1021.001"
  - "T1021"
log_sources:
  - "Microsoft Windows"
query: |
  dataset = microsoft_windows_raw 
  | filter event_id in (4624, 4625)
  | filter logon_type = 10
  | alter src_ip = json_extract_scalar(event_data, "$.IpAddress")
  | alter target_username = json_extract_scalar(event_data, "$.TargetUserName")
  | alter target_domain = json_extract_scalar(event_data, "$.TargetDomainName")
  | fields _time, host_name, src_ip, target_username, target_domain, event_id